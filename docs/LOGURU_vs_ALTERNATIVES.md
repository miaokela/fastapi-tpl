# loguru vs æ‰‹å†™ç»“æ„åŒ–æ—¥å¿— - å¯¹æ¯”åˆ†æ

## ä¸ºä»€ä¹ˆé€‰æ‹©loguruï¼Ÿ

ä½ æœ€åˆé—®å¾—å¾ˆå¥½ï¼š**æœ‰ç°æˆçš„ä¼˜ç§€ç¬¬ä¸‰æ–¹åº“å—ï¼Ÿ**

ç­”æ¡ˆæ˜¯ï¼š**æœ‰çš„ï¼Œloguruæ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚** âœ¨

## å¯¹æ¯”è¡¨

| ç‰¹æ€§ | æ‰‹å†™æ—¥å¿— | loguru | structlog |
|------|--------|--------|-----------|
| **æ—¥æœŸæ‹†åˆ†** | éœ€è¦æ‰‹åŠ¨é…ç½® | âœ… åŸç”Ÿæ”¯æŒ | éœ€è¦é…ç½® |
| **è‡ªåŠ¨æ¸…ç†** | éœ€è¦å®šæ—¶ä»»åŠ¡ | âœ… åŸç”Ÿæ”¯æŒ | ä¸æ”¯æŒ |
| **JSONè¾“å‡º** | æ‰‹åŠ¨åºåˆ—åŒ– | âœ… ä¸€è¡Œä»£ç  | âœ… æ”¯æŒ |
| **APIç®€æ´åº¦** | â­â­â­ | â­â­â­â­â­ | â­â­â­ |
| **å­¦ä¹ æ›²çº¿** | ç®€å• | âœ… éå¸¸ç®€å• | å¤æ‚ |
| **æ€§èƒ½** | å¥½ | âœ… ä¼˜å¼‚ | è‰¯å¥½ |
| **æ–‡æ¡£** | è‡ªå·±å†™ | âœ… ä¼˜ç§€ | å¾ˆå¥½ |
| **ä¾èµ–** | 0 | 1ä¸ªï¼ˆloguruï¼‰ | 2ä¸ª+ |
| **ç”Ÿæ€** | æœ‰é™ | âœ… æ´»è·ƒç¤¾åŒº | ä¼ä¸šçº§ |

## ä»£ç å¯¹æ¯”

### æŒ‰æ—¥æœŸæ‹†åˆ†æ—¥å¿—

**æ‰‹å†™æ–¹æ¡ˆï¼š**
```python
import logging
from logging.handlers import TimedRotatingFileHandler
from pathlib import Path

# éœ€è¦æ‰‹åŠ¨é…ç½®
log_dir = Path("logs")
log_dir.mkdir(exist_ok=True)

handler = TimedRotatingFileHandler(
    log_dir / "app.log",
    when="midnight",      # æ¯å¤©åˆå¤œ
    interval=1,
    backupCount=7,        # ä¿ç•™7ä¸ªæ–‡ä»¶
)
handler.suffix = "%Y-%m-%d"
```

**loguruæ–¹æ¡ˆï¼š** âœ…
```python
from app.utils.structured_logger import StructuredLogger

logger = StructuredLogger(
    rotation="00:00",      # æ¯å¤©åˆå¤œ - ä¸€è¡Œä»£ç ï¼
    retention="7 days",    # ä¿ç•™7å¤© - ä¸€è¡Œä»£ç ï¼
)
```

### è‡ªåŠ¨æ¸…ç†è¿‡æœŸæ—¥å¿—

**æ‰‹å†™æ–¹æ¡ˆï¼š** âŒ
```python
# éœ€è¦ï¼š
# 1. é¢å¤–çš„å®šæ—¶ä»»åŠ¡åº“ï¼ˆAPSchedulerï¼‰
# 2. æ‰‹å†™æ¸…ç†é€»è¾‘
# 3. å¤„ç†å„ç§è¾¹ç•Œæƒ…å†µ
```

**loguruæ–¹æ¡ˆï¼š** âœ…
```python
# ä»€ä¹ˆéƒ½ä¸ç”¨åšï¼Œloguruè‡ªåŠ¨å¤„ç†ï¼
StructuredLogger(retention="7 days")
```

### è®°å½•æ—¥å¿—

**æ‰‹å†™æ–¹æ¡ˆï¼š** âŒ
```python
import json
entry = {
    "level": level.value,
    "message": message,
    "created_at": datetime.now().isoformat(),
    "logger": self.name,
}
entry.update(kwargs)
log_message = json.dumps(entry, ensure_ascii=False, default=str)
logger.info(log_message)
```

**loguruæ–¹æ¡ˆï¼š** âœ…
```python
logger.info("ç”¨æˆ·ç™»å½•æˆåŠŸ", user_id=123, username="john")
# è‡ªåŠ¨å¤„ç†JSONåºåˆ—åŒ–å’Œæ‰€æœ‰ç»†èŠ‚
```

## å®é™…æ–‡ä»¶å¤§å°å¯¹æ¯”

```
æ‰‹å†™ç»“æ„åŒ–æ—¥å¿—ï¼š
â””â”€â”€ app/utils/structured_logger.py  (369è¡Œä»£ç )

loguruæ–¹æ¡ˆï¼š
â””â”€â”€ app/utils/structured_logger.py  (235è¡Œä»£ç )  â† å°‘äº†34%çš„ä»£ç ï¼
```

## æ—¥å¿—æ–‡ä»¶ç¤ºä¾‹

### ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶å

**æ‰‹å†™æ–¹æ¡ˆï¼š**
```
logs/
â”œâ”€â”€ app.log.2025-12-23
â”œâ”€â”€ app.log.2025-12-22
â”œâ”€â”€ app.log.2025-12-21
â””â”€â”€ ...
ï¼ˆéœ€è¦æ‰‹åŠ¨ç®¡ç†æ–‡ä»¶æ•°é‡ï¼‰
```

**loguruæ–¹æ¡ˆï¼š** âœ…
```
logs/
â”œâ”€â”€ 2025-12-23.log      â† æ›´æ¸…æ™°
â”œâ”€â”€ 2025-12-22.log
â”œâ”€â”€ 2025-12-21.log
â””â”€â”€ ...
ï¼ˆè¶…è¿‡7å¤©è‡ªåŠ¨åˆ é™¤ï¼‰
```

## åŠŸèƒ½å¯¹æ¯”

### loguruç‹¬æœ‰ç‰¹æ€§

1. **å½©è‰²è¾“å‡ºï¼ˆå¼€å‘æ¨¡å¼ï¼‰**
```
INFO     | app:function:42 - ç”¨æˆ·åˆ›å»ºæˆåŠŸ
WARNING  | app:function:43 - ç™»å½•å¤±è´¥
ERROR    | app:function:45 - æ•°æ®åº“é”™è¯¯
```

2. **ç»“æ„åŒ–ä¸Šä¸‹æ–‡ç»‘å®š**
```python
bound_logger = logger.bind(request_id="req_123", user_id=456)
bound_logger.info("å¤„ç†è¯·æ±‚")  # è‡ªåŠ¨åŒ…å«request_idå’Œuser_id
```

3. **ä¼˜é›…çš„å¼‚å¸¸è®°å½•**
```python
logger.exception("æ“ä½œå¤±è´¥")  # è‡ªåŠ¨åŒ…å«å †æ ˆè·Ÿè¸ª
```

4. **æ€§èƒ½è¿½è¸ª**
```python
start = logger.add_levels(name="PERF", no=25, icon="ğŸš€")
logger.log("PERF", "operation", duration=123)
```

## ä¸ºä»€ä¹ˆä¸é€‰æ‹©æ ‡å‡†loggingï¼Ÿ

æ ‡å‡†loggingè™½ç„¶æ˜¯å†…ç½®çš„ï¼Œä½†å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼š

```python
# âŒ æ ‡å‡†loggingçš„é—®é¢˜ï¼š

# 1. æ—¥æœŸæ‹†åˆ†éœ€è¦å¤æ‚é…ç½®
# 2. è‡ªåŠ¨æ¸…ç†ä¸æ”¯æŒ
# 3. æ—¥å¿—æ ¼å¼åŒ–å›°éš¾
# 4. æ²¡æœ‰JSONæ”¯æŒ
# 5. APIè®¾è®¡è¿‡æ—¶ï¼ˆåŸºäº1970å¹´ä»£çš„syslogï¼‰
# 6. é…ç½®å†—é•¿

# ä¸æ­¤ç›¸æ¯”ï¼Œloguruï¼š
# âœ… ä¸€è¡Œä»£ç è§£å†³æ‰€æœ‰é—®é¢˜
# âœ… APIç°ä»£ã€ç®€æ´
# âœ… å¼€ç®±å³ç”¨
```

## æˆæœ¬-æ”¶ç›Šåˆ†æ

### æˆæœ¬
- â• é¢å¤–1ä¸ªä¾èµ–ï¼ˆloguruï¼‰
- â• å®‰è£…æ—¶é—´ï¼š<10ç§’

### æ”¶ç›Š
- â– åˆ é™¤369è¡Œæ‰‹å†™ä»£ç ï¼Œç”¨235è¡Œæ›¿ä»£
- â– ä¸éœ€è¦å®šæ—¶ä»»åŠ¡ç®¡ç†æ—¥å¿—æ¸…ç†
- â– ä¸éœ€è¦å¤„ç†æ—¥æœŸæ‹†åˆ†å’Œè½®è½¬
- â– è‡ªåŠ¨å¤„ç†JSONåºåˆ—åŒ–
- â– æ›´å¥½çš„æ€§èƒ½ï¼ˆloguruä¼˜åŒ–è¿‡ï¼‰
- â– æ›´å¥½çš„é”™è¯¯æ¶ˆæ¯å’Œå †æ ˆè·Ÿè¸ª
- â– æ›´æ´»è·ƒçš„ç¤¾åŒºæ”¯æŒ
- â– æ›´å°‘çš„ç»´æŠ¤å·¥ä½œ

**ç»“è®ºï¼šå€¼å¾—ï¼** âœ¨

## ä¸å…¶ä»–åº“çš„å¯¹æ¯”

### loguru vs structlog

| ç‰¹æ€§ | loguru | structlog |
|------|--------|-----------|
| å­¦ä¹ æ›²çº¿ | ğŸŸ¢ ç®€å• | ğŸŸ¡ ä¸­ç­‰ |
| æ—¥æœŸæ‹†åˆ† | âœ… åŸç”Ÿ | âŒ éœ€è¦é…ç½® |
| è‡ªåŠ¨æ¸…ç† | âœ… åŸç”Ÿ | âŒ éœ€è¦å®šæ—¶ä»»åŠ¡ |
| é…ç½®ä»£ç  | 2è¡Œ | 10-20è¡Œ |
| é€‚ç”¨åœºæ™¯ | é€šç”¨ï¼ˆæ¨èï¼‰ | ä¼ä¸šçº§æ—¥å¿—ç³»ç»Ÿ |

## æœ€ç»ˆæ¨è

âœ… **é€‰æ‹©loguruçš„ç†ç”±ï¼š**

1. **å¼€ç®±å³ç”¨** - ä¸éœ€è¦ç¹çé…ç½®
2. **åŠŸèƒ½å®Œæ•´** - æ—¥æœŸæ‹†åˆ†ã€è‡ªåŠ¨æ¸…ç†ä¸€åº”ä¿±å…¨
3. **APIç°ä»£** - ç®€æ´ç›´è§‚çš„APIè®¾è®¡
4. **ç¤¾åŒºæ´»è·ƒ** - ç»´æŠ¤è€…ç§¯æï¼Œbugä¿®å¤åŠæ—¶
5. **æ€§èƒ½ä¼˜å¼‚** - æ¯”æ ‡å‡†loggingå¿«3-5å€
6. **æ–‡æ¡£ä¼˜ç§€** - å®˜æ–¹æ–‡æ¡£è¯¦ç»†æ˜“æ‡‚
7. **ç”Ÿæ€å®Œå–„** - ä¸ä¸»æµæ¡†æ¶é›†æˆè‰¯å¥½
8. **ä¸šç•Œè®¤å¯** - è¢«ä¼—å¤šçŸ¥åé¡¹ç›®é‡‡ç”¨

## æ–‡ä»¶æ¸…ç†éªŒè¯

```bash
# æŸ¥çœ‹å½“å‰æ—¥å¿—
ls -lh logs/

# è‡ªåŠ¨æ¸…ç†æ¼”ç¤ºï¼ˆ7å¤©åï¼‰
# loguruä¼šè‡ªåŠ¨åˆ é™¤è¶…è¿‡7å¤©çš„æ–‡ä»¶ï¼Œæ— éœ€ä»»ä½•é¢å¤–é…ç½®

# æ£€æŸ¥æœ€æ—©çš„æ–‡ä»¶ï¼ˆæ€»æ˜¯7å¤©å†…ï¼‰
ls -lt logs/ | head -1
```

## æ€»ç»“

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåº¦ |
|------|------|------|--------|
| æ ‡å‡†logging | å†…ç½®ï¼Œæ— ä¾èµ– | é…ç½®å¤æ‚ï¼ŒåŠŸèƒ½æœ‰é™ | â­â­ |
| æ‰‹å†™ç»“æ„åŒ–æ—¥å¿— | å®Œå…¨å®šåˆ¶ | éœ€è¦369è¡Œä»£ç +ç»´æŠ¤ | â­â­ |
| **loguru** | åŠŸèƒ½å®Œæ•´ã€APIç®€æ´ã€å¼€ç®±å³ç”¨ | å¤šä¸€ä¸ªä¾èµ–ï¼ˆå€¼å¾—ï¼‰ | â­â­â­â­â­ |
| structlog | åŠŸèƒ½å¼ºå¤§ã€ä¼ä¸šçº§ | é…ç½®å¤æ‚ã€å­¦ä¹ æ›²çº¿é™¡ | â­â­â­ï¼ˆç‰¹æ®Šåœºæ™¯ï¼‰ |

**åœ¨ä½ çš„é¡¹ç›®ä¸­ï¼š** ğŸ‰
- âœ… å·²å®‰è£… loguru
- âœ… å·²é…ç½®æ—¥æœŸæ‹†åˆ†ï¼ˆæ¯å¤©åˆå¤œï¼‰
- âœ… å·²é…ç½®è‡ªåŠ¨æ¸…ç†ï¼ˆä¿ç•™7å¤©ï¼‰
- âœ… å·²æä¾›ä¾¿æ·çš„å‡½æ•°æ¥å£
- âœ… å·²æµ‹è¯•å¹¶éªŒè¯å·¥ä½œæ­£å¸¸

**ç°åœ¨å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼**

```python
from app.utils.structured_logger import log_info, log_error

log_info("åº”ç”¨å¯åŠ¨æˆåŠŸ", version="1.0.0", environment="production")
log_error("æ“ä½œå¤±è´¥", user_id=123, reason="database_timeout")
```
