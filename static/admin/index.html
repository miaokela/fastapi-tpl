<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>后台管理系统</title>
    <link rel="stylesheet" href="/static/admin/css/style.css">
    <link rel="stylesheet" href="/static/admin/css/glassmorphism.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- 浮动气泡背景效果 -->
    <div class="floating-bubbles">
        <div class="bubble" style="width: 100px; height: 100px; left: 10%; top: 20%; animation-delay: 0s;"></div>
        <div class="bubble" style="width: 150px; height: 150px; left: 70%; top: 60%; animation-delay: 2s;"></div>
        <div class="bubble" style="width: 80px; height: 80px; left: 40%; top: 40%; animation-delay: 4s;"></div>
        <div class="bubble" style="width: 120px; height: 120px; left: 85%; top: 10%; animation-delay: 6s;"></div>
        <div class="bubble" style="width: 90px; height: 90px; left: 25%; top: 70%; animation-delay: 8s;"></div>
    </div>
    <!-- 登录页面 -->
    <div id="login-page" class="login-container">
        <div class="login-box">
            <div class="login-header">
                <i class="fas fa-cog"></i>
                <h1>后台管理系统</h1>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">
                        <i class="fas fa-user"></i>
                        用户名
                    </label>
                    <input type="text" id="username" name="username" required placeholder="请输入用户名">
                </div>
                <div class="form-group">
                    <label for="password">
                        <i class="fas fa-lock"></i>
                        密码
                    </label>
                    <input type="password" id="password" name="password" required placeholder="请输入密码">
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-sign-in-alt"></i>
                    登 录
                </button>
            </form>
            <div id="login-error" class="error-message" style="display: none;"></div>
        </div>
    </div>

    <!-- 管理后台主界面 -->
    <div id="admin-page" class="admin-container" style="display: none;">
        <!-- 侧边栏 -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <span>后台管理系统</span>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li class="nav-item active" data-page="users">
                        <a href="#">
                            <i class="fas fa-users"></i>
                            <span>用户管理</span>
                        </a>
                    </li>
                    <li class="nav-item" data-page="tasks">
                        <a href="#">
                            <i class="fas fa-clock"></i>
                            <span>定时任务</span>
                        </a>
                    </li>
                    <li class="nav-item" data-page="schedules">
                        <a href="#">
                            <i class="fas fa-calendar-alt"></i>
                            <span>调度管理</span>
                        </a>
                    </li>
                    <li class="nav-item" data-page="results">
                        <a href="#">
                            <i class="fas fa-list-alt"></i>
                            <span>执行记录</span>
                        </a>
                    </li>
                    <li class="nav-item" data-page="logs">
                        <a href="#">
                            <i class="fas fa-file-alt"></i>
                            <span>日志查询</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <button id="logout-btn" class="btn btn-outline">
                    <i class="fas fa-sign-out-alt"></i>
                    退出登录
                </button>
            </div>
        </aside>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 顶部导航栏 -->
            <header class="top-header">
                <div class="header-left">
                    <button id="sidebar-toggle" class="sidebar-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h2 id="page-title">用户管理</h2>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span id="current-user">管理员</span>
                    </div>
                </div>
            </header>

            <!-- 内容区域 -->
            <div class="content-wrapper">
                <!-- 用户管理页面 -->
                <div id="users-page" class="page-content active">
                    <div class="page-header">
                        <h3>用户列表</h3>
                        <button id="add-user-btn" class="btn btn-compact btn-primary">
                            <i class="fas fa-plus"></i>
                            新增用户
                        </button>
                    </div>
                    <div class="search-bar">
                        <input type="text" id="user-search" placeholder="搜索用户...">
                        <div class="custom-select-wrapper"><select id="user-status-filter">
                            <option value="">全部状态</option>
                            <option value="true">激活</option>
                            <option value="false">禁用</option>
                        </select></div>
                        <button id="user-search-btn" class="btn btn-compact btn-secondary">
                            <i class="fas fa-search"></i>
                            搜索
                        </button>
                    </div>
                    <div class="table-container glass-card">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>用户名</th>
                                    <th>邮箱</th>
                                    <th>状态</th>
                                    <th>超级管理员</th>
                                    <th>管理员</th>
                                    <th>创建时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination" id="users-pagination"></div>
                </div>

                <!-- 定时任务页面 -->
                <div id="tasks-page" class="page-content">
                    <div class="page-header">
                        <h3>定时任务列表</h3>
                        <button id="add-task-btn" class="btn btn-compact btn-primary">
                            <i class="fas fa-plus"></i>
                            新增任务
                        </button>
                    </div>
                    <div class="search-bar">
                        <div class="custom-select-wrapper"><select id="task-status-filter">
                            <option value="">全部状态</option>
                            <option value="true">启用</option>
                            <option value="false">禁用</option>
                        </select></div>
                        <button id="task-search-btn" class="btn btn-compact btn-secondary">
                            <i class="fas fa-filter"></i>
                            筛选
                        </button>
                    </div>
                    <div class="table-container glass-card">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>任务名称</th>
                                    <th>任务路径</th>
                                    <th>调度类型</th>
                                    <th>状态</th>
                                    <th>执行次数</th>
                                    <th>最后执行</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="tasks-table-body">
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination" id="tasks-pagination"></div>
                </div>

                <!-- 调度管理页面 -->
                <div id="schedules-page" class="page-content">
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="intervals">间隔调度</button>
                        <button class="tab-btn" data-tab="crontabs">Crontab调度</button>
                    </div>
                    
                    <!-- 间隔调度 -->
                    <div id="intervals-tab" class="tab-content active">
                        <div class="page-header">
                            <h3>间隔调度列表</h3>
                            <button id="add-interval-btn" class="btn btn-compact btn-primary">
                                <i class="fas fa-plus"></i>
                                新增间隔
                            </button>
                        </div>
                        <div class="table-container glass-card">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>间隔数量</th>
                                        <th>间隔类型</th>
                                        <th>显示</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="intervals-table-body">
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Crontab调度 -->
                    <div id="crontabs-tab" class="tab-content">
                        <div class="page-header">
                            <h3>Crontab调度列表</h3>
                            <button id="add-crontab-btn" class="btn btn-compact btn-primary">
                                <i class="fas fa-plus"></i>
                                新增Crontab
                            </button>
                        </div>
                        <div class="table-container glass-card">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>分钟</th>
                                        <th>小时</th>
                                        <th>星期</th>
                                        <th>日期</th>
                                        <th>月份</th>
                                        <th>时区</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="crontabs-table-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 执行记录页面 -->
                <div id="results-page" class="page-content">
                    <div class="page-header">
                        <h3>任务执行记录</h3>
                        <button id="cleanup-results-btn" class="btn btn-compact btn-danger">
                            <i class="fas fa-trash"></i>
                            清理记录
                        </button>
                    </div>
                    <div class="search-bar">
                        <input type="text" id="result-task-name" placeholder="任务名称...">
                        <div class="custom-select-wrapper"><select id="result-status-filter">
                            <option value="">全部状态</option>
                            <option value="SUCCESS">成功</option>
                            <option value="FAILURE">失败</option>
                            <option value="PENDING">等待中</option>
                        </select></div>
                        <button id="result-search-btn" class="btn btn-compact btn-secondary">
                            <i class="fas fa-search"></i>
                            搜索
                        </button>
                    </div>
                    <div class="table-container glass-card">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>任务ID</th>
                                    <th>任务名称</th>
                                    <th>状态</th>
                                    <th>Worker</th>
                                    <th>创建时间</th>
                                    <th>完成时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="results-table-body">
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination" id="results-pagination"></div>
                </div>

                <!-- 日志查询页面 -->
                <div id="logs-page" class="page-content">
                    <div class="page-header">
                        <h3>日志查询</h3>
                    </div>
                    
                    <div class="log-query-container">
                        <!-- 文件选择和查询表单 -->
                        <div class="query-panel glass-card">
                            <div class="form-group">
                                <label for="log-file-select">日志文件:</label>
                                <div class="custom-select-wrapper"><select id="log-file-select">
                                    <option value="">-- 选择日志文件 --</option>
                                </select></div>
                            </div>
                            
                            <div class="form-group">
                                <label for="jq-filter">jq 查询指令:</label>
                                <textarea id="jq-filter" placeholder="输入jq过滤表达式，例如：select(.user_id == 123)" rows="3"></textarea>
                            </div>
                            
                            <div class="query-examples">
                                <p><strong>查询示例:</strong></p>
                                <div class="examples-list">
                                    <button class="btn-example" data-filter="."><i class="fas fa-eye"></i>查看所有记录</button>
                                    <button class="btn-example" data-filter="select(.created_at | contains(&quot;2025-12-23&quot;))"><i class="fas fa-calendar-day"></i>今天的日志</button>
                                    <button class="btn-example" data-filter="select(.message | contains(&quot;成功&quot;))"><i class="fas fa-check-circle"></i>模糊查询-成功</button>
                                    <button class="btn-example" data-filter="select(has(&quot;user_id&quot;) and .user_id == 123)"><i class="fas fa-user"></i>特定用户查询</button>
                                    <button class="btn-example" data-filter="group_by(.message) | map({message: .[0].message, count: length})"><i class="fas fa-chart-bar"></i>按消息分组统计</button>
                                    <button class="btn-example" data-filter="select(.created_at >= &quot;2025-12-23 10:00&quot; and .created_at <= &quot;2025-12-23 11:00&quot;)"><i class="fas fa-clock"></i>时间范围查询</button>
                                    <button class="btn-example" data-filter="select(has(&quot;operation&quot;) and .operation == &quot;INSERT&quot;)"><i class="fas fa-database"></i>数据库INSERT操作</button>
                                    <button class="btn-example" data-filter="select(has(&quot;duration_ms&quot;) and .duration_ms > 10) | length"><i class="fas fa-stopwatch"></i>统计耗时大于10ms的操作数</button>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button id="log-query-btn" class="btn btn-compact btn-primary">
                                    <i class="fas fa-search"></i>
                                    执行查询
                                </button>
                                <button id="log-clear-btn" class="btn btn-compact btn-secondary">
                                    <i class="fas fa-times"></i>
                                    清空
                                </button>
                            </div>
                        </div>
                        
                        <!-- 查询结果 -->
                        <div class="results-panel glass-card">
                            <div id="log-results" class="log-results">
                                <p class="no-data">请选择日志文件并执行查询</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 日志详情模态框 -->
    <div id="log-detail-modal" class="modal">
        <div class="modal-content log-detail-modal glass-card">
            <div class="modal-header">
                <h3>日志详情</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <pre id="log-detail-content"></pre>
            </div>
        </div>
    </div>

    <!-- 模态框 -->
    <div id="modal" class="modal">
        <div class="modal-content glass-card">
            <div class="modal-header">
                <h3 id="modal-title">标题</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
            </div>
        </div>
    </div>

    <!-- Toast 消息 -->
    <div id="toast-container"></div>

    <script src="/static/admin/js/api.js"></script>
    <script src="/static/admin/js/app.js"></script>
</body>
</html>
